{% extends "langchain/base.html" %}

{% block title %}Monitor Interview: {{ interview.title }}{% endblock %}

{% block extra_css %}
<style>
    .transcript-container {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        overflow-y: auto;
        margin-right: 20px;
        display: flex;
        flex-direction: column;
        flex: 2;
    }
    .controls-container {
        width: 350px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        display: flex;
        flex-direction: column;
        flex: 1;
    }
    .status-indicator {
        height: 10px;
        width: 10px;
        border-radius: 50%;
        background-color: #6c757d;
        margin-right: 5px;
    }
    .status-indicator.active {
        background-color: #28a745;
    }
    .transcript-content {
        flex: 1;
        white-space: pre-wrap;
        font-family: 'Inter', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        height: 65vh;
        overflow-y: auto;
    }
    .interviewer-message {
        color: #4f46e5;
        font-weight: 500;
        margin-bottom: 10px;
    }
    .participant-message {
        color: #212529;
        margin-bottom: 20px;
    }
    .control-label {
        font-weight: 500;
        margin-bottom: 5px;
    }
    .emotion-chart {
        height: 200px;
        margin-bottom: 20px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #dee2e6;
    }
    .sentiment-indicator {
        height: 25px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #dee2e6;
        position: relative;
        overflow: hidden;
        margin-bottom: 20px;
    }
    .sentiment-level {
        position: absolute;
        height: 100%;
        background: linear-gradient(to right, #dc3545, #ffc107, #28a745);
        width: 100%;
    }
    .sentiment-marker {
        position: absolute;
        height: 25px;
        width: 3px;
        background-color: black;
        top: 0;
        z-index: 1;
    }
    .interview-stats {
        list-style: none;
        padding: 0;
        margin-bottom: 20px;
    }
    .interview-stats li {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.9rem;
    }
    .interview-stats .value {
        font-weight: 500;
    }
    .suggestion-box {
        background-color: #f8f9fa;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 20px;
        font-size: 0.9rem;
    }
    .live-indicator {
        display: inline-flex;
        align-items: center;
        padding: 5px 10px;
        background-color: rgba(220, 53, 69, 0.1);
        border-radius: 20px;
        color: #dc3545;
        font-size: 0.8rem;
        font-weight: 500;
    }
    .live-indicator .dot {
        height: 8px;
        width: 8px;
        background-color: #dc3545;
        border-radius: 50%;
        margin-right: 5px;
        animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
        0% {
            opacity: 1;
        }
        50% {
            opacity: 0.3;
        }
        100% {
            opacity: 1;
        }
    }
    .topic-list {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 20px;
    }
    .topic-tag {
        background-color: #e9ecef;
        padding: 3px 8px;
        border-radius: 15px;
        font-size: 0.8rem;
    }
    .btn-toolbar {
        margin-top: auto;
    }
    .monitor-container {
        display: flex;
        gap: 20px;
    }
    
    /* AI Observer Styles */
    .ai-note {
        background-color: rgba(79, 70, 229, 0.05);
        border-left: 3px solid rgba(79, 70, 229, 0.5);
        padding: 8px 12px;
        margin-top: 5px;
        font-size: 0.9rem;
        color: #495057;
        font-style: italic;
    }
    .ai-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 5px;
    }
    .ai-tag {
        background-color: rgba(79, 70, 229, 0.1);
        color: #4f46e5;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
    }
    .mood-timeline {
        height: 100px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #dee2e6;
        margin-bottom: 15px;
        position: relative;
    }
    .mood-point {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #4f46e5;
        transform: translate(-50%, -50%);
    }
    .observer-message {
        background-color: rgba(79, 70, 229, 0.03);
        border-radius: 8px;
        margin-bottom: 15px;
    }
    .observer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .observer-icon {
        color: #4f46e5;
        margin-right: 5px;
    }
    .observer-title {
        font-size: 0.8rem;
        font-weight: 500;
        color: #4f46e5;
    }
    .observer-status {
        font-size: 0.75rem;
        color: #6c757d;
    }
    .observer-content {
        padding: 10px 12px;
    }
    .tab-controls {
        margin-bottom: 15px;
    }
    .toggle-observer {
        display: inline-flex;
        align-items: center;
        font-size: 0.8rem;
        color: #495057;
        cursor: pointer;
        user-select: none;
        margin-bottom: 10px;
    }
    .toggle-observer input {
        margin-right: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3">Monitoring: {{ session.title if session and session.title else "Session" }}</h1>
            <div class="text-muted small">Session ID: {{ session_id }}</div>
        </div>
        <div class="d-flex align-items-center">
            <div class="live-indicator me-3">
                <span class="dot"></span> LIVE
            </div>
            <a href="/session/{{ session_id }}" class="btn btn-sm btn-outline-secondary me-2">
                <i class="bi bi-info-circle me-1"></i> Session Details
            </a>
            <button id="end-session-btn" class="btn btn-sm btn-danger">
                <i class="bi bi-stop-circle me-1"></i> End Session
            </button>
        </div>
    </div>
    
    <div class="row">
        <!-- Transcript Column (Left) -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Live Transcript</h5>
                    <div>
                        <button id="refresh-btn" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-arrow-clockwise me-1"></i> Refresh
                        </button>
                        <button id="copy-transcript-btn" class="btn btn-sm btn-outline-primary ms-2">
                            <i class="bi bi-clipboard me-1"></i> Copy
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="transcript-content" class="transcript-content">
                        <!-- Transcript messages will appear here -->
                        {% if session and session.messages %}
                            {% for message in session.messages %}
                                <div class="{% if message.role == 'assistant' %}interviewer-message{% else %}participant-message{% endif %}" data-message-id="{{ message.id }}">
                                    <strong>{% if message.role == 'assistant' %}AI Interviewer{% else %}Participant{% endif %}:</strong> {{ message.content }}
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-chat-dots fs-1 mb-3 d-block"></i>
                                <p>No messages yet. Waiting for the interview to begin...</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Researcher Controls -->
            <div class="card mt-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Interview Controls</span>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="suggestion-input" class="form-label">Suggest a question or follow-up:</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="suggestion-input" placeholder="Type a suggested question for the interviewer...">
                            <button class="btn btn-primary" id="send-suggestion-btn">
                                <i class="bi bi-send"></i> Send
                            </button>
                        </div>
                        <div class="form-text">This will be sent as a suggestion to the interviewer.</div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-primary" id="add-note-btn">
                            <i class="bi bi-journal-plus"></i> Add Research Note
                        </button>
                        <button class="btn btn-danger" id="end-interview-btn">
                            <i class="bi bi-x-circle"></i> End Interview
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Analytics Column (Right) -->
        <div class="col-lg-4">
            <!-- AI Observer Panel -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <h5 class="mb-0">AI Observer</h5>
                        <div class="ms-2">
                            <span class="badge bg-primary">
                                <i class="bi bi-robot"></i>
                            </span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="me-2">
                            <span class="status-indicator"></span>
                            <span id="observer-status" class="text-muted small">Initializing</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="tab-controls">
                        <label class="toggle-observer">
                            <input type="checkbox" id="observer-toggle" checked>
                            <span>Show AI observations</span>
                        </label>
                    </div>
                    
                    <h6 class="mb-2">Mood Timeline</h6>
                    <div id="mood-timeline" class="mood-timeline">
                        <!-- Mood points will be added here -->
                    </div>
                    
                    <h6 class="mb-2">Detected Topics</h6>
                    <div id="topics-list" class="topic-list mb-3">
                        <!-- Topics will be added here -->
                    </div>
                    
                    <button id="generate-summary-btn" class="btn btn-primary w-100">
                        <i class="bi bi-lightbulb me-1"></i> Generate Insights
                    </button>
                </div>
            </div>
            
            <!-- Interview Stats -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Session Stats</h5>
                </div>
                <div class="card-body">
                    <ul class="interview-stats">
                        <li>
                            <span class="label">Duration</span>
                            <span class="value" id="session-duration">00:00:00</span>
                        </li>
                        <li>
                            <span class="label">Messages</span>
                            <span class="value" id="message-count">
                                {{ session.messages|length if session and session.messages else 0 }}
                            </span>
                        </li>
                        <li>
                            <span class="label">Avg. Response Time</span>
                            <span class="value" id="avg-response-time">--</span>
                        </li>
                        <li>
                            <span class="label">Interviewer Talk %</span>
                            <span class="value" id="interviewer-talk-percent">--</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Observer Summary Modal -->
<div class="modal fade" id="observerSummaryModal" tabindex="-1" aria-labelledby="observerSummaryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="observerSummaryModalLabel">AI Observer Summary</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Summary content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="copy-summary-btn">
                    <i class="bi bi-clipboard me-1"></i> Copy Summary
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Note Modal -->
<div class="modal fade" id="addNoteModal" tabindex="-1" aria-labelledby="addNoteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addNoteModalLabel">Add Research Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="note-text" class="form-label">Note:</label>
                    <textarea class="form-control" id="note-text" rows="4" placeholder="Add your research observation or note here..."></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Note Type:</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="noteType" id="note-type-observation" value="observation" checked>
                        <label class="form-check-label" for="note-type-observation">
                            Observation
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="noteType" id="note-type-insight" value="insight">
                        <label class="form-check-label" for="note-type-insight">
                            Insight
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="noteType" id="note-type-question" value="question">
                        <label class="form-check-label" for="note-type-question">
                            Follow-up Question
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-note-btn">Save Note</button>
            </div>
        </div>
    </div>
</div>

<!-- End Interview Confirmation Modal -->
<div class="modal fade" id="endInterviewModal" tabindex="-1" aria-labelledby="endInterviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="endInterviewModalLabel">End Interview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i> 
                    Are you sure you want to end this interview?
                </div>
                <p>This will terminate the session and redirect the participant to the thank you page. The system will automatically generate an analysis based on the interview transcript.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-end-interview-btn">End Interview</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const sessionId = '{{ session_id }}';
        const transcriptContainer = document.getElementById('transcript-container');
        const messageInput = document.getElementById('suggestion-input');
        const sendBtn = document.getElementById('send-suggestion-btn');
        const addNoteBtn = document.getElementById('add-note-btn');
        const saveNoteBtn = document.getElementById('save-note-btn');
        const endInterviewBtn = document.getElementById('end-interview-btn');
        const confirmEndInterviewBtn = document.getElementById('confirm-end-interview-btn');
        
        // Initialize modals
        const addNoteModal = new bootstrap.Modal(document.getElementById('addNoteModal'));
        const endInterviewModal = new bootstrap.Modal(document.getElementById('endInterviewModal'));
        
        // Socket connection for real-time updates
        const socket = io();
        
        // Join monitoring room for this session
        socket.on('connect', function() {
            socket.emit('join_monitor_room', { session_id: sessionId });
            console.log('Connected to monitoring room for session:', sessionId);
        });
        
        // Listen for new messages
        socket.on('new_message', function(data) {
            if (data.session_id === sessionId && data.message) {
                // Add message to the transcript
                appendMessage(data.message);
                
                // Scroll to bottom 
                transcriptContainer.scrollTop = transcriptContainer.scrollHeight;
            }
        });
        
        // Listen for new observations
        socket.on('new_observation', function(data) {
            if (data.session_id === sessionId && data.observation) {
                // Update AI observer panel
                updateObservations(data.observation);
            }
        });
        
        // Listen for session completed event
        socket.on('session_completed', function(data) {
            if (data.session_id === sessionId) {
                console.log('Session completed:', data);
                // Show notification
                showNotification('Interview Completed', 'The interview has ended. Analysis is being generated.', 'info');
                
                // Disable controls
                messageInput.disabled = true;
                sendBtn.disabled = true;
                endInterviewBtn.disabled = true;
                
                // Add completion indicator to transcript
                const completionDiv = document.createElement('div');
                completionDiv.className = 'alert alert-info my-3 text-center';
                completionDiv.innerHTML = `
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <strong>Interview Completed</strong>
                    <p class="mb-0 mt-2">The interview has ended and analysis is being generated.</p>
                    <div class="mt-2">
                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <span class="ms-2">Generating analysis...</span>
                    </div>
                `;
                transcriptContainer.appendChild(completionDiv);
                transcriptContainer.scrollTop = transcriptContainer.scrollHeight;
            }
        });
        
        // Listen for analysis complete event
        socket.on('analysis_complete', function(data) {
            if (data.session_id === sessionId) {
                console.log('Analysis completed:', data);
                // Show notification
                showNotification('Analysis Ready', 'The interview analysis is now available.', 'success');
                
                // Update UI to show analysis is ready
                const completionDivs = transcriptContainer.querySelectorAll('.alert.alert-info');
                if (completionDivs.length > 0) {
                    const lastCompletionDiv = completionDivs[completionDivs.length - 1];
                    lastCompletionDiv.className = 'alert alert-success my-3 text-center';
                    lastCompletionDiv.innerHTML = `
                        <i class="bi bi-check-circle-fill me-2"></i>
                        <strong>Analysis Complete</strong>
                        <p class="mb-0 mt-2">The interview analysis is now ready.</p>
                        <a href="/interview_details/${sessionId}" class="btn btn-primary mt-2">
                            <i class="bi bi-file-text me-1"></i> View Analysis
                        </a>
                    `;
                }
            }
        });
        
        // Send a suggestion to the interviewer
        sendBtn.addEventListener('click', function() {
            const message = messageInput.value.trim();
            if (message) {
                // Send the suggestion via socket
                socket.emit('researcher_message', {
                    session_id: sessionId,
                    message: {
                        role: 'system',
                        content: message,
                        type: 'suggestion'
                    }
                });
                
                // Clear input field
                messageInput.value = '';
                
                // Show confirmation
                showNotification('Suggestion Sent', 'Your suggestion has been sent to the interviewer.', 'success');
            }
        });
        
        // Allow pressing Enter to send
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });
        
        // End Interview button click
        endInterviewBtn.addEventListener('click', function() {
            endInterviewModal.show();
        });
        
        // Confirm End Interview button click
        confirmEndInterviewBtn.addEventListener('click', function() {
            // Call the API to end the interview
            fetch(`/api/session/${sessionId}/complete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    should_analyze: true,
                    end_reason: "Researcher terminated interview from monitor interface",
                    researcher_notes: "Interview ended by researcher from monitoring interface"
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Hide the modal
                    endInterviewModal.hide();
                    
                    // Show notification
                    showNotification('Interview Ended', 'You have successfully ended the interview.', 'success');
                    
                    // Disable controls
                    messageInput.disabled = true;
                    sendBtn.disabled = true;
                    endInterviewBtn.disabled = true;
                    
                    // Socket will handle the UI update through session_completed event
                } else {
                    // Show error
                    showNotification('Error', data.error || 'Failed to end interview.', 'danger');
                }
            })
            .catch(error => {
                console.error('Error ending interview:', error);
                showNotification('Error', 'Network error occurred while ending interview.', 'danger');
            });
        });
        
        // Add Note button click
        addNoteBtn.addEventListener('click', function() {
            addNoteModal.show();
        });
        
        // Save Note button click
        saveNoteBtn.addEventListener('click', function() {
            const noteText = document.getElementById('note-text').value.trim();
            const noteType = document.querySelector('input[name="noteType"]:checked').value;
            
            if (noteText) {
                // Send note through socket
                socket.emit('researcher_message', {
                    session_id: sessionId,
                    message: {
                        role: 'system',
                        content: noteText,
                        type: 'researcher_note',
                        note_type: noteType
                    }
                });
                
                // Hide modal and clear input
                document.getElementById('note-text').value = '';
                addNoteModal.hide();
                
                // Show confirmation
                showNotification('Note Added', 'Your research note has been saved.', 'success');
            }
        });
        
        // Helper function to append message to transcript
        function appendMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${message.role}`;
            
            if (message.role === 'system') {
                // System messages (suggestions, notes)
                messageDiv.className += ' message-system';
                let icon = 'info-circle';
                let title = 'System';
                
                if (message.type === 'suggestion') {
                    icon = 'lightbulb';
                    title = 'Suggestion';
                } else if (message.type === 'researcher_note') {
                    icon = 'journal-text';
                    title = 'Research Note';
                    
                    if (message.note_type === 'insight') {
                        icon = 'lightbulb';
                        title = 'Insight';
                    } else if (message.note_type === 'question') {
                        icon = 'question-circle';
                        title = 'Follow-up Question';
                    }
                }
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <i class="bi bi-${icon}"></i>
                        <strong>${title}</strong>
                        <span class="text-muted ms-2 small">${formatTimestamp(message.timestamp)}</span>
                    </div>
                    <div class="message-content">${message.content}</div>
                `;
            } else {
                // Regular messages (user/assistant)
                const role = message.role === 'assistant' ? 'AI' : 'Participant';
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <strong>${role}</strong>
                        <span class="text-muted ms-2 small">${formatTimestamp(message.timestamp)}</span>
                    </div>
                    <div class="message-content">${message.content}</div>
                `;
            }
            
            transcriptContainer.appendChild(messageDiv);
        }
        
        // Helper function to update AI observations
        function updateObservations(observation) {
            // Implementation depends on your UI structure
            // This is just a placeholder that should be adapted to your actual UI
            
            // Update mood chart if available
            if (observation.sentiment && typeof updateMoodChart === 'function') {
                updateMoodChart(observation.sentiment);
            }
            
            // Update topics/tags if available
            if (observation.topics && observation.topics.length > 0) {
                const topicsContainer = document.getElementById('detected-topics');
                if (topicsContainer) {
                    observation.topics.forEach(topic => {
                        if (!document.querySelector(`.topic-tag[data-topic="${topic}"]`)) {
                            const topicTag = document.createElement('span');
                            topicTag.className = 'badge bg-info me-1 mb-1 topic-tag';
                            topicTag.setAttribute('data-topic', topic);
                            topicTag.textContent = topic;
                            topicsContainer.appendChild(topicTag);
                        }
                    });
                }
            }
            
            // Add observation to notes list if available
            if (observation.notes && observation.notes.length > 0) {
                const notesContainer = document.getElementById('ai-observations');
                if (notesContainer) {
                    observation.notes.forEach(note => {
                        const noteDiv = document.createElement('div');
                        noteDiv.className = 'observation-note mb-2 p-2 border-start border-3 border-info';
                        noteDiv.innerHTML = `<p class="mb-0 small">${note}</p>`;
                        notesContainer.appendChild(noteDiv);
                    });
                }
            }
        }
        
        // Helper function to format timestamp
        function formatTimestamp(timestamp) {
            if (!timestamp) return '';
            
            try {
                const date = new Date(timestamp);
                return date.toLocaleTimeString();
            } catch (e) {
                return timestamp;
            }
        }
        
        // Helper function to show notifications
        function showNotification(title, message, type) {
            // Create notification container if it doesn't exist
            if (!document.getElementById('notification-container')) {
                const container = document.createElement('div');
                container.id = 'notification-container';
                container.className = 'position-fixed top-0 end-0 p-3';
                container.style.zIndex = 1050;
                document.body.appendChild(container);
            }
            
            const notificationId = 'notification-' + new Date().getTime();
            const notification = document.createElement('div');
            notification.className = `toast show bg-${type} text-white`;
            notification.id = notificationId;
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'assertive');
            notification.setAttribute('aria-atomic', 'true');
            
            notification.innerHTML = `
                <div class="toast-header bg-${type} text-white">
                    <strong class="me-auto">${title}</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            document.getElementById('notification-container').appendChild(notification);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
    });
</script>
{% endblock %} 